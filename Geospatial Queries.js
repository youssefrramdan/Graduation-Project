
// MongoDB ุชุฏุนู ุงูุจุญุซ ุงูุฌุบุฑุงูู ุจุงุณุชุฎุฏุงู GeoJSON ุฃู ุฅุญุฏุงุซูุงุช Legacy Coordinate Pairs
//!! -----------------------------------------------------------------------------------------------

/*
======================================
๐ ูุง ูู `$geometry` ูู ุงูุงุณุชุนูุงูุงุช ุงูุฌุบุฑุงููุฉ ูู MongoDBุ
======================================
*/

// ๐น `$geometry` ูู ูุดุบู ููุณุชุฎุฏู ุฏุงุฎู ุงูุงุณุชุนูุงูุงุช ุงูุฌุบุฑุงููุฉ (`$geoWithin`, `$geoIntersects`, `$near`)
// ูุชุญุฏูุฏ ุดูู ุฌุบุฑุงูู GeoJSON ููุณุชุฎุฏู ูู ุงูุจุญุซ.
// ูุณูุญ ูู ุจุชุญุฏูุฏ ููุน ุงูุดูู (`Point`, `Polygon`, `LineString`, ุฅูุฎ) ูุฅุญุฏุงุซูุงุชู (`coordinates`).

/*
๐ ุงูุตูุบุฉ ุงูุนุงูุฉ ูู `$geometry`:
{
  "$geometry": {
    "type": "Point" | "Polygon" | "LineString",
    "coordinates": [...]
  }
}
*/
//! -------------------------------------------------------------------------------
/*
๐ก ุงูุงุณุชุฎุฏุงูุงุช:
โ ุงูุจุญุซ ุนู ุงูุฃูุงูู ุงููุฑูุจุฉ ูุซู ุงููุทุงุนู ุฃู ุงูุญุฏุงุฆู ุฃู ุงููุชุงุฌุฑ.
โ ุญุณุงุจ ุงููุณุงูุงุช ุจูู ุงูููุงุท ุงูุฌุบุฑุงููุฉ.
โ ุงูุจุญุซ ุนู ุงูุฃูุงูู ุฏุงุฎู ููุทูุฉ ูุนููุฉ ูุซู ูุฏููุฉ ุฃู ุฏุงุฆุฑุฉ ุฃู ูุถูุน.
*/

// 1๏ธโฃ ุชุฎุฒูู ุงูุจูุงูุงุช ุงูุฌุบุฑุงููุฉ ุจุงุณุชุฎุฏุงู GeoJSON
const place = {
  name: "Central Park",
  location: {
    type: "Point",
    coordinates: [-73.97, 40.77], // [longitude, latitude]
  },
  category: "Parks"
};

// ุฅุฏุฑุงุฌ ุงูุจูุงูุงุช ูู MongoDB
// db.places.insertOne(place);


/*
======================================
๐ ุฅูุดุงุก ุงูููุงุฑุณ ุงูุฌุบุฑุงููุฉ (Geospatial Indexes)
======================================
*/

// ๐น ุฅูุดุงุก ููุฑุณ 2dsphere ูุชุญุณูู ุงูุจุญุซ ุงูุฌุบุฑุงูู
// ูุฐุง ุงูููุฑุณ ุถุฑูุฑู ูุชูููู ุงูุงุณุชุนูุงูุงุช ุงูุฌุบุฑุงููุฉ

db.places.createIndex({ location: "2dsphere" });


/*
======================================
๐ ุงูุจุญุซ ุนู ุงูุฃูุงูู ุงููุฑูุจุฉ ุจุงุณุชุฎุฏุงู `$near`
======================================
*/

// ุงูุจุญุซ ุนู ุงูุฃูุงูู ุงููุฑูุจุฉ ุถูู ูุทุงู ุจูู 1000m ู5000m ูู ููุทุฉ ูุนููุฉ

db.places.find({
  location: {
    $near: {
      $geometry: { type: "Point", coordinates: [-73.9667, 40.78] },
      $minDistance: 1000, // ุงูุญุฏ ุงูุฃุฏูู ูููุณุงูุฉ (ุจุงููุชุฑ)
      $maxDistance: 5000  // ุงูุญุฏ ุงูุฃูุตู ูููุณุงูุฉ (ุจุงููุชุฑ)
    }
  }
});


/*
======================================
๐ ุงูุจุญุซ ุนู ุงูุฃูุงูู ุฏุงุฎู ููุทูุฉ ุจุงุณุชุฎุฏุงู `$geoWithin`
======================================
*/

// ุงูุจุญุซ ุนู ุงูุฃูุงูู ุฏุงุฎู ูุถูุน ูุนูู (Polygon)

db.places.find({
  location: {
    $geoWithin: {
      $geometry: {
        type: "Polygon",
        coordinates: [
          [
            [-80.0, 10.00], [-80.0, 9.00], [-79.0, 9.0],
            [-79.0, 10.00], [-80.0, 10.0]
          ]
        ]
      }
    }
  }
});


/*
======================================
๐ ุงูุจุญุซ ุนู ุงูุฃูุงูู ุงูุชู ุชุชูุงุทุน ูุน ุฎุท ูุนูู ุจุงุณุชุฎุฏุงู `$geoIntersects`
======================================
*/

// ุงูุจุญุซ ุนู ุฌููุน ุงูุฃูุงูู ุงูุชู ุชุชูุงุทุน ูุน ุฎุท ูุนูู (LineString)

db.places.find({
  location: {
    $geoIntersects: {
      $geometry: {
        type: "LineString",
        coordinates: [[-73.97, 40.77], [-73.99, 40.75]]
      }
    }
  }
});


/*
======================================
๐ ุงูุจุญุซ ุนู ุฃูุฑุจ ุงูุฃูุงูู ุจุงุณุชุฎุฏุงู `$geoNear`
======================================
*/
// ๐ ูุซุงู ุนูู ุงูุจูุงูุงุช ุงูููุฏุฎูุฉ (places Collection)

// [
//   {
//     "name": "Central Park",
//     "location": { "type": "Point", "coordinates": [-73.97, 40.77] },
//     "category": "Parks"
//   },
//   {
//     "name": "Sara D. Roosevelt Park",
//     "location": { "type": "Point", "coordinates": [-73.9928, 40.7193] },
//     "category": "Parks"
//   },
//   {
//     "name": "Polo Grounds",
//     "location": { "type": "Point", "coordinates": [-73.9375, 40.8303] },
//     "category": "Stadiums"
//   }
// ]

// ุงูุจุญุซ ุนู ุฌููุน ุงูุญุฏุงุฆู (`category: "Parks"`) ูุฑุชุจุฉ ุญุณุจ ุงูุฃูุฑุจ ุฅูู ููุทุฉ ูุนููุฉ

db.places.aggregate([
  {
    $geoNear: {
      near: { type: "Point", coordinates: [-73.9667, 40.78] }, // ุงูููุทุฉ ุงูุชู ูุจุญุซ ุญูููุง
      spherical: true, // ูุฌุนู ุงูุจุญุซ ูุชู ุนูู ูุฑุฉ ุฃุฑุถูุฉ ูููุณุช ูุณุทุญุฉ (WGS84)
      query: { category: "Parks" }, // ุชุตููุฉ ุงูุจุญุซ ููุดูู ููุท ุงูุฃูุงูู ูู ููุน "Parks"
      distanceField: "calcDistance" // ุงุณู ุงูุญูู ุงูุฐู ุณูุญุชูู ุนูู ุงููุณุงูุฉ ุงููุญุณูุจุฉ
    }
  }
]);



/*
======================================
๐ ูุชู ูุณุชุฎุฏู `2dsphere` ููุชู ูุณุชุฎุฏู `2d`ุ
======================================
*/

/*
| ููุน ุงูุงุณุชุนูุงู | ุงุณุชุฎุฏู `2dsphere` | ุงุณุชุฎุฏู `2d` |
|--------------|------------------|------------|
| ุงูุจุญุซ ุนู ุฃูุฑุจ ููุทุฉ (`$near`) | โ | โ |
| ุงูุจุญุซ ุฏุงุฎู ูุถูุน (`$geoWithin`) | โ | โ |
| ุงูุจุญุซ ุนู ุชูุงุทุน (`$geoIntersects`) | โ | โ |
| ุงูุจุญุซ ุนู ูุณุงูุงุช ุฏูููุฉ ุนูู ุงููุฑุฉ ุงูุฃุฑุถูุฉ | โ | โ |
| ุงูุจุญุซ ุนูู ุณุทุญ ูุณุชูู (2D) | โ | โ |
*/


/*
======================================
๐ฅ ููุฎุต ุณุฑูุน
======================================
*/

// โ ููููู ุชุฎุฒูู ุงูุจูุงูุงุช ุงูุฌุบุฑุงููุฉ ุจุงุณุชุฎุฏุงู `GeoJSON` ุฃู `Legacy Coordinate Pairs`.
// โ ูุชุญุณูู ุณุฑุนุฉ ุงูุงุณุชุนูุงูุงุชุ ุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ููุฑุณ `2dsphere` ุฃู `2d`.
// โ ููููู ุงูุจุญุซ ุนู ุงูุฃูุงูู ุงููุฑูุจุฉ ุจุงุณุชุฎุฏุงู `$near` ุฃู `$geoNear`.
// โ ููููู ุงูุจุญุซ ุนู ุงูุฃูุงูู ุฏุงุฎู ููุทูุฉ ูุญุฏุฏุฉ ุจุงุณุชุฎุฏุงู `$geoWithin`.
// โ ููููู ุงูุจุญุซ ุนู ุงูุฃูุงูู ุงูุชู ุชุชูุงุทุน ูุน ุดูู ูุนูู ุจุงุณุชุฎุฏุงู `$geoIntersects`.

// ๐ ุงูุขู ููููู ุชูููุฐ ุงุณุชุนูุงูุงุช ุฌุบุฑุงููุฉ ูุชูุฏูุฉ ุจุณูููุฉ ูู MongoDB!
// ๐ก ูู ูุฏูู ุฃู ุงุณุชูุณุงุฑุงุช ุฃุฎุฑูุ ๐


